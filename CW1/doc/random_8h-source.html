<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>BEAST - Bioinspired Evolutionary Agent Simulation Toolkit: random.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Compound&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Compound&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>random.h</h1><a href="random_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00011 <span class="preprocessor">#ifndef _RANDOM_H_</span>
00012 <span class="preprocessor"></span><span class="preprocessor">#define _RANDOM_H_</span>
00013 <span class="preprocessor"></span>
00014 <span class="preprocessor">#include &lt;cmath&gt;</span>
00015 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
00016 <span class="preprocessor">#include &lt;ctime&gt;</span>
00017 <span class="preprocessor">#include &lt;iostream&gt;</span>
00018 <span class="preprocessor">#include &lt;functional&gt;</span>
00019 
00025 <span class="comment">/*Real may be double or float*/</span>
00026 <span class="comment">//#define Real double</span>
00027 <span class="comment">// DG: This has been replaced with C++ template syntax. Where real numbers are</span>
00028 <span class="comment">// involved, make calls using the type you want returning as parameters, or if</span>
00029 <span class="comment">// there are no parameters, include the desired output type in &lt;&gt;'s, e.g.</span>
00030 <span class="comment">// gaussrand&lt;float&gt;();</span>
00031 
00032 <span class="comment">/*ran1 from the numerical recipes in c book -- it's the slowest but (?) best*/</span>
00033 
00034 <span class="preprocessor">#define M1 259200</span>
00035 <span class="preprocessor"></span><span class="preprocessor">#define IA1 7141</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#define IC1 54773</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#define RM1 (1.0/M1)</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#define M2 134456</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#define IA2 8121</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#define IC2 28411</span>
00041 <span class="preprocessor"></span><span class="preprocessor">#define RM2 (1.0/M2)</span>
00042 <span class="preprocessor"></span><span class="preprocessor">#define M3 243000</span>
00043 <span class="preprocessor"></span><span class="preprocessor">#define IA3 4561</span>
00044 <span class="preprocessor"></span><span class="preprocessor">#define IC3 51349</span>
00045 <span class="preprocessor"></span>
00046 <span class="comment">/********************* ran1 *******************/</span>
00047 
00048 <span class="keyword">inline</span> <span class="keywordtype">float</span> ran1(<span class="keywordtype">int</span>* idum)
00049 {
00050     <span class="keyword">static</span> <span class="keywordtype">long</span> ix1,ix2,ix3;
00051     <span class="keyword">static</span> <span class="keywordtype">float</span> r[98];
00052     <span class="keywordtype">float</span> temp;
00053     <span class="keyword">static</span> <span class="keywordtype">int</span> iff=0;
00054     <span class="keywordtype">int</span> j;
00055     <span class="keywordtype">void</span> nrerror();
00056 
00057     <span class="keywordflow">if</span> (*idum &lt; 0 || iff == 0) {
00058         iff=1;
00059         ix1=(IC1-(*idum)) % M1;
00060         ix1=(IA1*ix1+IC1) % M1;
00061         ix2=ix1 % M2;
00062         ix1=(IA1*ix1+IC1) % M1;
00063         ix3=ix1 % M3;
00064         <span class="keywordflow">for</span> (j=1;j&lt;=97;j++) {
00065             ix1=(IA1*ix1+IC1) % M1;
00066             ix2=(IA2*ix2+IC2) % M2;
00067             r[j]=static_cast&lt;float&gt;((ix1+ix2*RM2)*RM1);
00068         }
00069         *idum=1;
00070     }
00071     ix1=(IA1*ix1+IC1) % M1;
00072     ix2=(IA2*ix2+IC2) % M2;
00073     ix3=(IA3*ix3+IC3) % M3;
00074     j=1 + ((97*ix3)/M3);
00075     <span class="keywordflow">if</span> (j &gt; 97 || j &lt; 1)
00076     <span class="comment">/* nrerror("RAN1: This cannot happen."); */</span>
00077         std::cerr &lt;&lt; <span class="stringliteral">"RAN1: This cannot happen."</span> &lt;&lt; std::endl;
00078     temp=r[j];
00079     r[j]=static_cast&lt;float&gt;((ix1+ix2*RM2)*RM1);
00080     <span class="keywordflow">return</span> temp;
00081 }
00082 
00083 <span class="preprocessor">#undef M1</span>
00084 <span class="preprocessor"></span><span class="preprocessor">#undef IA1</span>
00085 <span class="preprocessor"></span><span class="preprocessor">#undef IC1</span>
00086 <span class="preprocessor"></span><span class="preprocessor">#undef RM1</span>
00087 <span class="preprocessor"></span><span class="preprocessor">#undef M2</span>
00088 <span class="preprocessor"></span><span class="preprocessor">#undef IA2</span>
00089 <span class="preprocessor"></span><span class="preprocessor">#undef IC2</span>
00090 <span class="preprocessor"></span><span class="preprocessor">#undef RM2</span>
00091 <span class="preprocessor"></span><span class="preprocessor">#undef M3</span>
00092 <span class="preprocessor"></span><span class="preprocessor">#undef IA3</span>
00093 <span class="preprocessor"></span><span class="preprocessor">#undef IC3</span>
00094 <span class="preprocessor"></span>
00095 <span class="comment">/************************************************/</span>
00096 
00097 <span class="comment">/* Reseeds the random number generator from the system clock.</span>
00098 <span class="comment"> * if the argument is zero then the system clock is used, otherwise the</span>
00099 <span class="comment"> * argument is the seed</span>
00100 <span class="comment"> */</span>
00101 <span class="keyword">inline</span> <span class="keywordtype">int</span> rseed(<span class="keywordtype">int</span> *s, <span class="keywordtype">bool</span> verbose)
00102 {
00103     time_t tseed;
00104     <span class="keywordtype">int</span>    seed;
00105 
00106     <span class="keywordflow">if</span>((*s)==0)
00107     {
00108         time(&amp;tseed);
00109         seed=static_cast&lt;int&gt;(tseed%32767);
00110         *s=seed;
00111     }
00112     <span class="keywordflow">else</span> seed=*s;
00113 
00114     <span class="keywordflow">if</span>(verbose) std::cout &lt;&lt; <span class="stringliteral">"\n: Seed is "</span> &lt;&lt; seed &lt;&lt; std::endl;
00115     <span class="comment">/* srandom(seed); */</span>
00116     seed=seed*-1;
00117     ran1(&amp;seed);
00118     <span class="keywordflow">return</span>(*s);
00119 }
00120 
00125 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Real&gt;
<a name="l00126"></a><a class="code" href="group__utilities.html#a4">00126</a> <span class="keyword">inline</span> Real <a class="code" href="group__utilities.html#a4">randval</a>(Real limit)
00127 {
00128     <span class="keywordtype">float</span>  rv;
00129     <span class="keywordtype">int</span>    i=1;
00130     <span class="comment">/*get a random value in the range 0..1*/</span>
00131     <span class="comment">/*rv=random()/MAX_RAND*/</span>
00132     rv=ran1(&amp;i);
00133     <span class="keywordflow">return</span>(<a class="code" href="group__utilities.html#a20">limit</a>*(static_cast&lt;Real&gt;(rv)));
00134 }
00135 
00136 
<a name="l00140"></a><a class="code" href="group__utilities.html#a5">00140</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__utilities.html#a5">irand</a>(<span class="keywordtype">int</span> limit)
00141 {
00142     <span class="keywordtype">int</span> ir;
00143     <span class="comment">/*while loop is used to trap the exceptional case where</span>
00144 <span class="comment">    the underlying deviate in [0,1] actually returns 1.00*/</span>
00145     ir=<a class="code" href="group__utilities.html#a20">limit</a>;
00146     <span class="keywordflow">while</span>(ir==<a class="code" href="group__utilities.html#a20">limit</a>)
00147     {
00148         ir=static_cast&lt;int&gt;(floor(<a class="code" href="group__utilities.html#a4">randval</a>(static_cast&lt;double&gt;(<a class="code" href="group__utilities.html#a20">limit</a>))));
00149     }
00150     <span class="keywordflow">return</span>(ir);
00151 }
00152 
00153 <span class="keyword">inline</span> <span class="keywordtype">bool</span> brand(<span class="keywordtype">double</span> p)
00154 {
00155     <span class="keywordflow">return</span> <a class="code" href="group__utilities.html#a4">randval</a>(1.0) &lt;= p;
00156 }
00157 
00158 <span class="keyword">inline</span> <span class="keywordtype">bool</span> brand(<span class="keywordtype">float</span> p)
00159 {
00160     <span class="keywordflow">return</span> <a class="code" href="group__utilities.html#a4">randval</a>(1.0f) &lt;= p;
00161 }
00162 
00166 <span class="keyword">template</span> &lt;&gt;
<a name="l00167"></a><a class="code" href="group__utilities.html#a8">00167</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__utilities.html#a4">randval</a>(<span class="keywordtype">int</span> limit)
00168 {
00169     <span class="keywordflow">return</span> <a class="code" href="group__utilities.html#a5">irand</a>(<a class="code" href="group__utilities.html#a20">limit</a> + 1);
00170 }
00171 
00172 <span class="keyword">template</span> &lt;&gt;
00173 <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="group__utilities.html#a4">randval</a>(<span class="keywordtype">bool</span>)
00174 {
00175     <span class="keywordflow">return</span> brand(0.5);
00176 }
00177 
00184 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Real&gt;
<a name="l00185"></a><a class="code" href="group__utilities.html#a10">00185</a> <span class="keyword">inline</span> Real <a class="code" href="group__utilities.html#a10">gaussrand</a>(<span class="keywordtype">void</span>)
00186 {
00187     <span class="keyword">static</span> <span class="keywordtype">int</span> iset=0;
00188     <span class="keyword">static</span> Real gset;
00189     Real fac,r,v1,v2;
00190 
00191     <span class="keywordflow">if</span>(iset==0)
00192     {
00193         <span class="keywordflow">do</span> {
00194             v1=2.0*<a class="code" href="group__utilities.html#a4">randval</a>(1.0)-1.0;
00195             v2=2.0*<a class="code" href="group__utilities.html#a4">randval</a>(1.0)-1.0;
00196             r=(v1*v1)+(v2*v2);
00197         } <span class="keywordflow">while</span> (r&gt;=1.0);
00198 
00199         fac=sqrt(-2.0*log(r)/r);
00200         gset=v1*fac;
00201         iset=1;
00202         <span class="keywordflow">return</span>(v2*fac);
00203     }
00204     <span class="keywordflow">else</span> {
00205         iset=0;
00206         <span class="keywordflow">return</span>(gset);
00207     }
00208 }
00209 
00214 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Real&gt;
<a name="l00215"></a><a class="code" href="group__utilities.html#a11">00215</a> Real <a class="code" href="group__utilities.html#a11">normrand</a>(Real mean,Real sd)
00216 { 
00217     <span class="keywordflow">return</span>((sd*<a class="code" href="group__utilities.html#a10">gaussrand</a>())+mean);
00218 }
00219 
00224 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> _Type&gt;
<a name="l00225"></a><a class="code" href="structRandom.html">00225</a> <span class="keyword">struct </span><a class="code" href="structRandom.html">Random</a> : <span class="keyword">public</span> std::unary_function&lt;_Type, _Type&gt; {
00226     <a class="code" href="structRandom.html">Random</a>(): <a class="code" href="group__utilities.html#a20">limit</a>(static_cast&lt;_Type&gt;(1.0)){}
00227     <a class="code" href="structRandom.html">Random</a>(_Type l): <a class="code" href="group__utilities.html#a20">limit</a>(l){}
00228     _Type operator()(_Type n) {
00229         <span class="keywordflow">return</span> <a class="code" href="group__utilities.html#a4">randval</a>(n);
00230     }
00231     _Type operator()() {
00232         <span class="keywordflow">return</span> <a class="code" href="group__utilities.html#a4">randval</a>(limit);
00233     }
00234     _Type limit;
00235 };
00236 
00241 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Feb 1 21:25:34 2004 for BEAST - Bioinspired Evolutionary Agent Simulation Toolkit by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.2 </small></address>
</body>
</html>
