<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>BEAST - Bioinspired Evolutionary Agent Simulation Toolkit: world.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Compound&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Compound&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>world.h</h1><a href="world_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00007 <span class="preprocessor">#ifndef _WORLD_H_</span>
00008 <span class="preprocessor"></span><span class="preprocessor">#define _WORLD_H_</span>
00009 <span class="preprocessor"></span>
00010 <span class="preprocessor">#include &lt;vector&gt;</span>
00011 <span class="preprocessor">#include &lt;deque&gt;</span>
00012 <span class="preprocessor">#include &lt;algorithm&gt;</span>
00013 <span class="preprocessor">#include &lt;functional&gt;</span>
00014 
00015 <span class="preprocessor">#include "vector2d.h"</span>
00016 <span class="preprocessor">#include "<a class="code" href="animat_8h.html">animat.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="animatmonitor_8h.html">animatmonitor.h</a>"</span>
00018 <span class="preprocessor">#include "worldobject.h"</span>
00019 <span class="preprocessor">#include "<a class="code" href="collisions_8h.html">collisions.h</a>"</span>
00020 <span class="preprocessor">#include "<a class="code" href="random_8h.html">random.h</a>"</span>
00021 <span class="preprocessor">#include "sensorfunctors.h"</span>
00022 
00023 <span class="keyword">namespace </span>BEAST {
00024 
00030 <span class="comment">// Forward declaration for Animat container</span>
00031 <span class="keyword">class </span>Animat;
00032 
00033 <span class="keyword">const</span> <span class="keywordtype">double</span> WORLD_WIDTH = 800.0;
00034 <span class="keyword">const</span> <span class="keywordtype">double</span> WORLD_HEIGHT = 600.0;
00035 
<a name="l00040"></a><a class="code" href="group__framework.html#a22">00040</a> <span class="keyword">enum</span> <a class="code" href="group__framework.html#a22">WorldDisplayType</a> {
00041     <a class="code" href="group__framework.html#a22a78">DISPLAY_NONE</a> = 0,           
00042     <a class="code" href="group__framework.html#a22a79">DISPLAY_ANIMATS</a> = 1,        
00043     <a class="code" href="group__framework.html#a22a80">DISPLAY_WORLDOBJECTS</a> = 2,   
00044     <a class="code" href="group__framework.html#a22a81">DISPLAY_TRAILS</a> = 4,         
00045     <a class="code" href="group__framework.html#a22a82">DISPLAY_SENSORS</a> = 8,        
00046     <a class="code" href="group__framework.html#a22a83">DISPLAY_COLLISIONS</a> = 16,    
00047     <a class="code" href="group__framework.html#a22a84">DISPLAY_MONITOR</a> = 32,       
00048     <a class="code" href="group__framework.html#a22a85">DISPLAY_ALL</a> = 65535         
00049 };
00050 
<a name="l00056"></a><a class="code" href="classBEAST_1_1World.html">00056</a> <span class="keyword">class </span><a class="code" href="classBEAST_1_1World.html">World</a>
00057 {
00059     <span class="keyword">typedef</span> std::vector&lt;Animat*&gt; AnimatContainer;
00061     <span class="keyword">typedef</span> std::vector&lt;WorldObject*&gt; WorldObjectContainer;
00063     <span class="keyword">typedef</span> AnimatContainer::iterator AnimatIter;
00065     <span class="keyword">typedef</span> WorldObjectContainer::iterator WorldObjectIter;
00066 
00067 <span class="keyword">public</span>:
00068     <a class="code" href="classBEAST_1_1World.html#a0">World</a>();
00069     ~<a class="code" href="classBEAST_1_1World.html">World</a>(){};
00070 
00071     <span class="keywordtype">void</span>                <a class="code" href="classBEAST_1_1World.html#a2">Init</a>();
00072     <span class="keywordtype">void</span>                <a class="code" href="classBEAST_1_1World.html#a3">InitGL</a>()<span class="keyword">const</span>;
00073     <span class="keywordtype">void</span>                <a class="code" href="classBEAST_1_1World.html#a4">Add</a>(<a class="code" href="classBEAST_1_1Animat.html">Animat</a>* r);
00074     <span class="keywordtype">void</span>                <a class="code" href="classBEAST_1_1World.html#a4">Add</a>(<a class="code" href="classBEAST_1_1WorldObject.html">WorldObject</a>* r);
<a name="l00076"></a><a class="code" href="classBEAST_1_1World.html#a6">00076</a>     <span class="keywordtype">void</span>                <a class="code" href="classBEAST_1_1World.html#a6">AddCollision</a>(<a class="code" href="classBEAST_1_1Vector2D.html">Vector2D</a> pv) { collisions.push_back(pv); }
00077 
00084     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; 
<a name="l00085"></a><a class="code" href="classBEAST_1_1World.html#a7">00085</a>     <span class="keywordtype">void</span> <a class="code" href="classBEAST_1_1World.html#a4">Add</a>(<span class="keyword">const</span> vector&lt;T*&gt;&amp; v)
00086     {
00087         <span class="keyword">using</span> std::vector;
00088 
00089         <a class="code" href="classBEAST_1_1Animat.html">Animat</a>* ptra;
00090         <a class="code" href="classBEAST_1_1WorldObject.html">WorldObject</a>* ptrw;
00091         <span class="keywordflow">for</span> (<span class="keyword">typename</span> vector&lt;T*&gt;::const_iterator i = v.begin(); i != v.end(); ++i) {
00092             ptra = dynamic_cast&lt;Animat*&gt;(*i);
00093             <span class="keywordflow">if</span> (ptra != NULL) {
00094                 <a class="code" href="classBEAST_1_1World.html#a4">Add</a>(ptra);
00095                 <span class="keywordflow">continue</span>;
00096             }
00097 
00098             ptrw = dynamic_cast&lt;WorldObject*&gt;(*i);
00099             <span class="keywordflow">if</span> (ptrw != NULL) {
00100                 <a class="code" href="classBEAST_1_1World.html#a4">Add</a>(ptrw);
00101             }
00102         }
00103     }
00104 
00110     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00111"></a><a class="code" href="classBEAST_1_1World.html#a8">00111</a>     <span class="keywordtype">void</span> <a class="code" href="classBEAST_1_1World.html#a9">Remove</a>(vector&lt;T*&gt;&amp; v)
00112     {
00113         <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00114 
00115         <span class="keywordflow">if</span> (updateInProgress) <span class="keywordflow">return</span>;
00116 
00117         T* ptr;
00118         WorldObjectIter i = remove_if(worldobjects.begin(), 
00119                                       worldobjects.end(), 
00120                                       bind2nd(ptr_fun(IsKindOf&lt;T, WorldObject&gt;), ptr));
00121         <span class="keywordflow">for</span> (WorldObjectIter ii = i; ii != worldobjects.end(); ++ii) {
00122             v.push_back(static_cast&lt;T*&gt;(*ii));
00123         }
00124         worldobjects.erase(i, worldobjects.end());
00125 
00126         AnimatIter j = remove_if(animats.begin(), 
00127                                  animats.end(), 
00128                                  bind2nd(ptr_fun(IsKindOf&lt;T, Animat&gt;), ptr));
00129         <span class="keywordflow">for</span> (AnimatIter ii = i; ii != animats.end(); ++ii) {
00130             v.push_back(static_cast&lt;T*&gt;(*ii));
00131         }
00132         animats.erase(i, animats.end());
00133     }
00134 
00139     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00140"></a><a class="code" href="classBEAST_1_1World.html#a9">00140</a>     <span class="keywordtype">void</span> <a class="code" href="classBEAST_1_1World.html#a9">Remove</a>()
00141     {
00142         <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00143 
00144         <span class="keywordflow">if</span> (updateInProgress) <span class="keywordflow">return</span>;
00145 
00146         worldobjects.erase( remove_if(worldobjects.begin(), 
00147                                       worldobjects.end(), 
00148                                       <a class="code" href="structBEAST_1_1MatchKindOf.html">MatchKindOf&lt;T&gt;</a>()),
00149                             worldobjects.end());
00150 
00151         animats.erase(      remove_if(animats.begin(), 
00152                                       animats.end(), 
00153                                       <a class="code" href="structBEAST_1_1MatchKindOf.html">MatchKindOf&lt;T&gt;</a>()),
00154                             animats.end());
00155 
00156         monitor.erase(      remove_if(monitor.begin(),
00157                                       monitor.end(),
00158                                       <a class="code" href="structBEAST_1_1MatchKindOf.html">MatchKindOf&lt;T&gt;</a>()),
00159                             monitor.end());
00160     }
00161 
00162     <span class="comment">// lifecycle functions</span>
00163     <span class="keywordtype">void</span>                <a class="code" href="classBEAST_1_1World.html#a10">Display</a>();
00164     <span class="keywordtype">void</span>                <a class="code" href="classBEAST_1_1World.html#a11">Update</a>();
00165     <span class="keywordtype">void</span>                <a class="code" href="classBEAST_1_1World.html#a12">CleanUp</a>();
00166 
00167     <span class="comment">// events</span>
00168     <span class="keywordtype">void</span>                OnMouseLDown(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y);
00169     <span class="keywordtype">void</span>                OnMouseRDown(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y);
00170     <span class="keywordtype">void</span>                OnMouseLUp(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y);
00171     <span class="keywordtype">void</span>                OnMouseRUp(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y);
00172     <span class="keywordtype">void</span>                OnMouseMove(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y);
00173     <span class="keywordtype">void</span>                OnSelectNext();
00174     <span class="keywordtype">void</span>                OnSelectPrevious();
00175 
00176     <span class="comment">// helpers</span>
00177     <span class="keyword">inline</span> Vector2D     <a class="code" href="group__framework.html#a61">Centre</a>();   
00178     <span class="keyword">inline</span> Vector2D     <a class="code" href="group__framework.html#a62">RandomLocation</a>()<span class="keyword">const</span>;  
00179 
00180     <span class="comment">// Mutators:</span>
00181     <span class="keywordtype">void</span>                SetWidth(<span class="keywordtype">double</span> w)          { disp.width = w; }
00182     <span class="keywordtype">void</span>                SetHeight(<span class="keywordtype">double</span> h)         { disp.height = h; }
00183     <span class="keywordtype">void</span>                SetWindow(<span class="keywordtype">int</span> w, <span class="keywordtype">int</span> h)     { disp.winWidth = w; disp.winHeight = h; }
00184     <span class="keywordtype">void</span>                Toggle(WorldDisplayType t)  { disp.config ^= t; }
00185     <span class="keywordtype">void</span>                SetColour(<span class="keyword">const</span> <span class="keywordtype">float</span> c[3]) { SetColour(c[0], c[1], c[2]); }
00186     <span class="keyword">inline</span> <span class="keywordtype">void</span>         SetColour(<span class="keywordtype">float</span> r, <span class="keywordtype">float</span> g, <span class="keywordtype">float</span> b);
00187 
00188     <span class="comment">// accessors</span>
<a name="l00190"></a><a class="code" href="classBEAST_1_1World.html#a28">00190</a> <span class="comment"></span>    <span class="keywordtype">double</span>              <a class="code" href="classBEAST_1_1World.html#a28">GetWidth</a>()<span class="keyword">const</span>     { <span class="keywordflow">return</span> disp.width; }
<a name="l00192"></a><a class="code" href="classBEAST_1_1World.html#a29">00192</a>     <span class="keywordtype">double</span>              <a class="code" href="classBEAST_1_1World.html#a29">GetHeight</a>()<span class="keyword">const</span>    { <span class="keywordflow">return</span> disp.height; }
<a name="l00194"></a><a class="code" href="classBEAST_1_1World.html#a30">00194</a>     <span class="keywordtype">int</span>                 <a class="code" href="classBEAST_1_1World.html#a30">GetWinWidth</a>()<span class="keyword">const</span>  { <span class="keywordflow">return</span> static_cast&lt;int&gt;(disp.winWidth); }
<a name="l00196"></a><a class="code" href="classBEAST_1_1World.html#a31">00196</a>     <span class="keywordtype">int</span>                 <a class="code" href="classBEAST_1_1World.html#a31">GetWinHeight</a>()<span class="keyword">const</span> { <span class="keywordflow">return</span> static_cast&lt;int&gt;(disp.winHeight); }
<a name="l00198"></a><a class="code" href="classBEAST_1_1World.html#a32">00198</a>     <span class="keywordtype">int</span>                 <a class="code" href="classBEAST_1_1World.html#a32">GetDispConfig</a>()<span class="keyword">const</span>{ <span class="keywordflow">return</span> disp.config; }
<a name="l00200"></a><a class="code" href="classBEAST_1_1World.html#a33">00200</a>     <span class="keywordtype">bool</span>                <a class="code" href="classBEAST_1_1World.html#a33">IsUpdating</a>()<span class="keyword">const</span>   { <span class="keywordflow">return</span> updateInProgress; }
<a name="l00205"></a><a class="code" href="classBEAST_1_1World.html#a34">00205</a>     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="classBEAST_1_1World.html#a34">Get</a>(vector&lt;T*&gt;&amp; v)
00206     {
00207         <span class="keyword">using</span> std::vector;
00208 
00209         T* ptr;
00210         <span class="keywordflow">for</span> (AnimatIter i = animats.begin(); i != animats.end(); ++i) {
00211             ptr = dynamic_cast&lt;T*&gt;(*i);
00212             <span class="keywordflow">if</span> (ptr != NULL) {
00213                 v.push_back(ptr);
00214             }
00215         }
00216 
00217         <span class="keywordflow">for</span> (WorldObjectIter i = worldobjects.begin(); i != worldobjects.end(); ++i) {
00218             ptr = dynamic_cast&lt;T*&gt;(*i);
00219             <span class="keywordflow">if</span> (ptr != NULL) {
00220                 v.push_back(ptr);
00221             }
00222         }
00223     }
00224     WorldObject*        GetSelected()<span class="keyword">const</span>          { <span class="keywordflow">return</span> mouse.selected; }
00225 
<a name="l00228"></a><a class="code" href="classBEAST_1_1World.html#a36">00228</a>     AnimatContainer::const_iterator <a class="code" href="classBEAST_1_1World.html#a36">AnimatsBegin</a>()<span class="keyword">const</span> { <span class="keywordflow">return</span> animats.begin(); }
<a name="l00231"></a><a class="code" href="classBEAST_1_1World.html#a37">00231</a>     AnimatContainer::const_iterator <a class="code" href="classBEAST_1_1World.html#a37">AnimatsEnd</a>()<span class="keyword">const</span> { <span class="keywordflow">return</span> animats.end(); }
<a name="l00234"></a><a class="code" href="classBEAST_1_1World.html#a38">00234</a>     WorldObjectContainer::const_iterator <a class="code" href="classBEAST_1_1World.html#a38">WorldObjectsBegin</a>()<span class="keyword">const</span> { <span class="keywordflow">return</span> worldobjects.begin(); }
<a name="l00237"></a><a class="code" href="classBEAST_1_1World.html#a39">00237</a>     WorldObjectContainer::const_iterator <a class="code" href="classBEAST_1_1World.html#a39">WorldObjectsEnd</a>()<span class="keyword">const</span> { <span class="keywordflow">return</span> worldobjects.end(); }
00238 
00239 <span class="keyword">private</span>:
00240     AnimatContainer     animats, animatQueue;
00241     WorldObjectContainer worldobjects, worldobjectQueue;
00242 
00243     Collisions          collisions;
00244     AnimatMonitor       monitor;
00245 
00246     <span class="keywordtype">bool</span>                updateInProgress;
00247 
00248     <span class="keyword">struct </span>PointerInfo {
00249         PointerInfo():left(false),right(false),current(NULL),selected(NULL){}
00250         Vector2D        location;
00251         Vector2D        staticLocation;
00252         <span class="keywordtype">bool</span>            left;
00253         <span class="keywordtype">bool</span>            right;
00254         WorldObject*    current;
00255         WorldObject*    selected;
00256     } mouse;
00257 
00258     <span class="keyword">struct </span>DisplayInfo {
00259         DisplayInfo():
00260             width(WORLD_WIDTH),height(WORLD_HEIGHT),
00261             winWidth(WORLD_WIDTH), winHeight(WORLD_HEIGHT),
00262             config(<a class="code" href="group__framework.html#a22a85">DISPLAY_ALL</a>){}
00263         <span class="keywordtype">double</span>          width;
00264         <span class="keywordtype">double</span>          height;
00265         <span class="keywordtype">double</span>          winWidth;
00266         <span class="keywordtype">double</span>          winHeight;
00267         <span class="keywordtype">int</span>             config;
00268         <span class="keywordtype">float</span>           colour[3];
00269     } disp;
00270 
00271     Vector2D            WindowXY(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y);
00272     <span class="keyword">inline</span> <span class="keywordtype">void</span>         UpdateMouse();
00273     <span class="keyword">inline</span> <span class="keywordtype">void</span>         UpdateQueues();
00274 };
00275 
<a name="l00276"></a><a class="code" href="classBEAST_1_1World.html#a61">00276</a> <a class="code" href="classBEAST_1_1Vector2D.html">Vector2D</a> World::Centre()
00277 {
00278     <span class="keywordflow">return</span> <a class="code" href="classBEAST_1_1Vector2D.html">Vector2D</a>(disp.width / 2.0, disp.height / 2.0);
00279 }
00280 
<a name="l00281"></a><a class="code" href="classBEAST_1_1World.html#a62">00281</a> <a class="code" href="classBEAST_1_1Vector2D.html">Vector2D</a> World::RandomLocation()<span class="keyword">const</span> {
00282     <span class="keywordflow">return</span> <a class="code" href="classBEAST_1_1Vector2D.html">Vector2D</a>(disp.width * static_cast&lt;double&gt;(rand()-1)/static_cast&lt;double&gt;(RAND_MAX),
00283                     disp.height * static_cast&lt;double&gt;(rand()-1)/static_cast&lt;double&gt;(RAND_MAX));
00284 }
00285 
00286 <span class="keywordtype">void</span> World::SetColour(<span class="keywordtype">float</span> r, <span class="keywordtype">float</span> g, <span class="keywordtype">float</span> b)
00287 {
00288     disp.colour[0] = r;
00289     disp.colour[1] = g;
00290     disp.colour[2] = b;
00291     glClearColor(r, g, b, 1.0f);
00292 }
00293 
00298 } <span class="comment">// namespace BEAST</span>
00299 
00300 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Feb 1 21:25:35 2004 for BEAST - Bioinspired Evolutionary Agent Simulation Toolkit by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.2 </small></address>
</body>
</html>
